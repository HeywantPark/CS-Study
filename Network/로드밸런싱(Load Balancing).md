# 로드 밸런싱(Load Balancing)

**로드 밸런싱** <br>

> 로드(Load) : 서버가 받는 부하 (트래픽)

: 둘 혹은 셋 이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업(Work), 즉, 부하(Load)를 나눔 <br>
: 가용성 및 응답시간을 최적화시킬 수 있음 <br>
: 트래픽들을 잘 밸런싱해서 서버에게 골고루 분산 <br>

## 로드밸런서

: 로드 밸런싱 해주는 모듈 <br>

- 주요 기능
  - 부하 분산
  - 오토 스케일링
  - Health Check : 해당 포트에 트래픽을 보내 애플리케이션이 올바르게 작동하는지 판별
  - 보안 서비스 WAF, NAT

<br>

---

<br>

## 트래픽이 늘어났을 경우😫

### 1. Vertical Scale-UP

: 가지고 있는 서버 자체의 퍼포먼스를 늘리는 방법 <br>

EX) RAM 4GB → 32GB 늘리기 / 더 좋은 CPU 교체 <br>

- 단순히 머신 하나의 늘리는 정도는 한계가 있음, 기술의 한계 有

### 2. Horizontal Scale-Out

: idea - 한 대로 처리할 것을 N대로 처리 <br>
: **분산 시스템 구축** <br>
➡ **로드밸런싱** <br>

![](/Network/images/loadbalance.png)

<br>

---

<br>

## 로드 밸런싱 수행 전략

### ROUND ROBIN

![](/Network/images/roundrobin.jpg)

- 여러 대의 서버가 있을 때, 들어오는 리퀘스트를 순차적으로 하나씩 그 서버들에게 보냄
- 모든 서버에 보내면 다시 처음부터 하나씩
- 모든 서버가 트래픽을 골고루 분산해서 가져갈 수 있는 심플한 알고리즘

<br>

### RANDOM SELECT

- 리퀘스트가 들어왔을 때 로드밸런서가 랜덤으로 서버에 보냄
- 운이 나쁘면 한 서버에 계속 보내서 부하가 걸리는 경우가 생길 수 있음 - BUT 많지 않음^^ ~ 거의 균일하게 리퀘스트 받음
- 구현도 쉽고 간단해서 라운드 로빈과 마찬가지로 좋은 알고리즘

<br>

### Least Connection

![](/Network/images/leastconnection.jpg)

- 어플리케이션 서버가 로드밸런서한테 감당하고 있는 트래픽량과 커넥션 수를 역으로 알려줌
- 로드밸런서가 이 정보를 가지고 다이나믹하게 판단
- 어플리케이션 서버와 로드밸런서 간의 실시간 통신이 이뤄져야 해서 조금 복잡

<br>

### Ratio

![](/Network/images/ratio.jpg)

- 로드밸런서가 미리 서버의 스펙을 계산해서 Ratio(가중치)를 정함
- 성능이 좋은 서버에게 많이 주고 안 좋은 서버에겐 덜 줌

<br>

> **같은 스펙의 서버들을 가지고 분산 시스템을 구축하는 것이 좋음**

<br>

---

<br>

## 로드 밸런싱 구현·구축 방법

### 1. 소프트웨어적 방식

- 로직을 구현해서 트래픽을 분산시키는 방법
- 단순히 로직만 구현하면 되기 때문에 비용 저렴
- 설정 파일만 수정하면 서버를 쉽게 추가하거나 확장(Scale-Out)할 수 있음
  - 하드웨어 추가 없이 Configuration 변경만으로 확장 가능
    EX) HAProxy, Reverse Proxy(Nginx, Apache)

<br>

### 2. 하드웨어적 방식

- 물리적으로 서버를 묶는 방법
- 비용이 비쌈
- 안정성이 높음
- IDC에서 물리적으로 관리되기 때문에 보안 측면에서도 좋음
  EX) L4 Swtich, L7 Switch

<br>

---

<br>

## 🤔만약 로드밸런서가 죽으면?

- 서비스도 죽는다^.^
- 특정 포인트에서 에너가 났을 때 전체 시스템이 다운되는 경우 → SPOF(Single Point of Failure) <br>
  ➡ **로드밸런서 자체도 Scale-Out 할 필요가 있는 모듈**

<br>

## 로드밸런서 확장 방법

### 1. 마스터 슬레이브 방식

- 마스터가 항상 일을 하되 여벌로 한 두대 정도 더 가지고 있음
- 마스터가 죽으면 슬레이브를 바로 마스터로 임명 시켜서 서비스는 계속 이어갈 수 있게

### 2. Active-Active 방식

- 모든 로드밸런서가 동시에 트래픽을 처리
- 현업에서 가장 많이 사용되는 방식

<br>

---

###### https://www.youtube.com/watch?v=9_6COPOMZvI
