# Servlet

## 1. 서블릿(Servlet)이란?

![image1](https://github.com/user-attachments/assets/22ce5533-c84e-4748-96b9-1117043dc3c6)

서블릿(Servlet)이란 동적 웹 페이지를 만들 때 사용되는 자바 기반의 웹 애플리케이션 프로그래밍 기술이다. 서블릿은 웹 요청과 응답의 흐름을 간단한 메서드 호출만으로 체계적으로 다룰 수 있게 해준다.

서블릿은 서버에서 실행되다가 웹 브라우저에서 요청을 하면 해당 기능을 수행한 후 웹 브라우저에 결과를 전송한다.

쉽게 예를 들면 로그인 시도를 할 때, 서버가 클라이언트에서 입력되는 아이디와 비밀번호를 확인하고 결과를 응답하는데 이러한 역할을 수행하는 것이 서블릿이다.

### 서블릿(Servlet)의 주요 특징
- 클라이언트의 Request에 대해 동적으로 작동하는 웹 어플리케이션 컴포넌트
- 기존의 정적 웹 프로그램의 문제점을 보완하여 동적인 여러 가지 기능을 제공
- JAVA의 스레드를 이용하여 동작
- MVC 패턴에서 컨트롤러로 이용됨
- 컨테이너에서 실행
- 보안 기능을 적용하기 쉬움

## 2. 서블릿의 동작 과정

![image2](https://github.com/user-attachments/assets/145c740d-aaef-463c-82dc-9c0c2f5ac8e3)

클라이언트가 웹 서버에 요청하면 웹 서버는 그 요청을 톰캣과 같은 WAS에 위임한다. 그러면 WAS는 각 요청에 해당하는 서블릿을 실행한다. 그리고 서블릿은 요청에 대한 기능을 수행한 후 결과를 반환하여 클라이언트에 전송한다.

1. 클라이언트 요청
2. `HttpServletRequest`, `HttpServletResponse` 객체 생성
3. `web.xml`이 어느 서블릿에 대해 요청한 것인지 탐색
4. 해당하는 서블릿에서 `service()` 메소드 호출
5. `doGet()` 또는 `doPost()` 호출
6. 동적 페이지 생성 후 `ServletResponse` 객체에 응답 전송
7. `HttpServletRequest`, `HttpServletResponse` 객체 소멸

> **`web.xml`** : 서블릿을 작성했다면 해당 서블릿을 사용자가 요청한 경로와 매핑시켜야 WAS에서 매핑된 정보를 읽어서 브라우저에서 해당 URL로 HTTP 요청 시 해당 서블릿으로 요청을 전달해 줄 수 있다. 소스를 분석할 때도 가장 먼저 확인해봐야 할 부분이다. 톰캣을 예로 들면 웹 애플리케이션 서비스 처리에 대해 정의된 환경 설정 파일이 server 디렉터리의 `web.xml`에 있다.

### 서블릿 형식
```java
public class FirstServlet extends HttpServlet {
    @Override
    public void init() {
        // 초기화 작업
    }

    @Override
    public void doGet(HttpServletRequest req, HttpServletResponse resp) {
        // 요청 처리 작업
    }

    @Override
    public void destroy() {
        // 종료 작업
    }
}
```

## 3. 서블릿의 생명주기

서블릿도 자바 클래스이므로 실행하면 초기화부터 서비스 수행 후 소멸하기까지의 과정을 거친다. 이 과정을 서블릿의 **생명주기**라 하며, 각 단계마다 호출되어 기능을 수행하는 콜백 메서드를 **서블릿 생명주기 메서드**라 한다.

1. **초기화**: 클라이언트의 요청이 들어오면 컨테이너는 해당 서블릿이 메모리에 있는지 확인하고, 없을 경우 `init()` 메서드를 호출하여 메모리에 적재한다.
2. **서비스 수행**: `service()` 메소드를 통해 요청에 대한 응답이 `doGet()`과 `doPost()`로 분기된다.
3. **종료**: 컨테이너가 서블릿에 종료 요청을 하면 `destroy()` 메서드가 호출된다.

### 서블릿 생명주기 메서드
- **초기화**: `init()`
  - 서블릿 요청 시 맨 처음 한 번만 호출된다.
  - 서블릿 생성 시 초기화 작업을 주로 수행한다.
- **작업 수행**: `doGet()`, `doPost()`
  - 서블릿 요청 시 매번 호출된다.
  - 실제로 클라이언트가 요청하는 작업을 수행한다.
- **종료**: `destroy()`
  - 서블릿이 기능을 수행하고 메모리에서 소멸될 때 호출된다.
  - 서블릿의 마무리 작업을 주로 수행한다.

## 4. 서블릿 컨테이너

서블릿 컨테이너란, 구현되어 있는 servlet 클래스의 규칙에 맞게 서블릿을 담고 관리해주는 컨테이너다. 클라이언트에서 요청을 하면 컨테이너는 `HttpServletRequest`, `HttpServletResponse` 두 객체를 생성하여 post, get 여부에 따라 동적인 페이지를 생성하여 응답을 보낸다.

### 주요 기능

- **웹서버와의 통신 지원**
  - 서블릿 컨테이너는 서블릿과 웹서버가 손쉽게 통신할 수 있게 해준다.
  - 일반적으로 소켓을 만들고 listen, accept 등을 해야 하지만 서블릿 컨테이너는 이러한 기능을 API로 제공하여 복잡한 과정을 생략할 수 있다.

- **서블릿 생명주기 관리**
  - 서블릿 클래스를 로딩하여 인스턴스화하고, 초기화 메소드를 호출하며, 요청이 들어오면 적절한 서블릿 메소드를 호출한다.
  - 수명이 다 된 서블릿은 적절하게 가비지 콜렉터를 호출하여 필요없는 자원 낭비를 막아준다.

- **멀티쓰레드 지원 및 관리**
  - Request가 올 때마다 새로운 자바 쓰레드를 생성하여 HTTP 서비스 메소드를 실행한다.
  - 쓰레드는 자동으로 소멸되며, 서버가 다중 쓰레드를 생성 및 운영하므로 안정성에 대해 걱정할 필요가 없다.

- **선언적인 보안 관리**
  - 보안 관련 내용을 XML 배포 서술자에 기록하여 자바 소스 코드를 수정하지 않아도 보안 관리를 할 수 있다.
