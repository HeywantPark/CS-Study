# 교착 상태

## 교착 상태란?
교착 상태란 2개 이상의 작업이 동시에 이루어지는 경우, 다른 작업이 끝나기만 기다리며 작업을 더 이상 진행하지 못하는 상태를 의미한다.  
교착 상태는 **기아 상태(Starvation)**와 비슷해 보이지만 차이가 있다.  
기아 상태는 잘못된 정책으로 특정 프로세스의 작업이 지연되는 문제인 반면, 교착 상태는 여러 프로세스가 작업을 진행하다 보니 발생하는 자연적인 현상이다.

![교착상태](https://github.com/user-attachments/assets/e4ca9726-326e-4e7d-988c-9f719be26229)

---

## 자원 할당 그래프
자원 할당 그래프는 프로세스가 어떤 자원을 사용 중이고 어떤 자원을 기다리고 있는지를 방향성이 있는 그래프로 표현한 것이다.  
- **프로세스**: 원(circle)으로 표현  
- **자원**: 사각형(rectangle)으로 표현  
- **화살표 방향**:
  - 자원을 사용하는 경우: 자원 → 프로세스  
  - 자원을 기다리는 경우: 프로세스 → 자원  

![다운로드 (1)](https://github.com/user-attachments/assets/fb16eaf6-deba-4401-ad20-b0002a6e258d)

자원 할당 그래프가 원형을 이루면 교착 상태가 발생할 수 있다.

---

## 교착 상태 필요조건
교착 상태는 다음 네 가지 조건이 동시에 충족되어야 발생한다:
1. **상호 배제**:  
   - 특정 자원을 하나의 프로세스만 사용할 수 있음.
2. **비선점**:  
   - 할당된 자원을 다른 프로세스가 강제로 빼앗을 수 없음.
3. **점유와 대기**:  
   - 자원을 점유한 상태에서 다른 자원을 기다림.
4. **원형 대기**:  
   - 점유와 대기를 하는 프로세스들 간의 관계가 원형을 이룸.

---

## 교착 상태 해결 방법
교착 상태를 해결하기 위한 방법은 아래와 같다:

### 1. 교착 상태 예방
교착 상태를 유발하는 네 가지 조건이 발생하지 않도록 무력화하는 방식이다. 
즉, 상호 배제 예방, 비선점 예방, 점유와 대기 예방, 원형 대기 예방의 방법 중 하나를 사용하여 네 가지 조건 중 하나의 조건을 무력화시킴으로써 교착 상태가 발생하지 않게 하는 방식이다.
 
이때, 상호 배제 예방과 비선점 예방은 사실상 불가능한 예방 방법이다. 
왜냐하면, 상호 배제 예방을 한다는 것은 독점적으로 사용할 수 있는 자원을 없애버린다는 것과 똑같고, 비선점 예방을 한다는 것은 모든 자원을 빼앗을 수 있도록 만든다는 것과 똑같다. 
이는 현실적으로 불가능한 방법이다.

반면, 점유와 대기 예방, 원형 대기 예방은 현실적으로 불가능하지는 않은 방법이다.

- **현실적인 예방 방법**:
  - **점유와 대기 예방**:
    - 프로세스가 자원을 점유한 상태에서 다른 자원을 기다리지 못하게 하는 방법이다.
      다시 말해, 자원을 전부 할당하거나 아예 할당하지 않는 방식(all or nothing)을 적용하는 것이다.
      이를 위해 프로세스는 작업 초기에 자신이 사용하려는 모든 자원을 한꺼번에 점유하거나, 그렇지 못할 경우 자원을 모두 반납해야 한다.
  - **원형 대기 예방**:
    - 점유와 대기를 하는 프로세스들이 원형을 이루지 못하도록 막는 방법이다. 모든 자원에 숫자를 부여하고 숫자가 큰 방향으로만 자원을 할당하는 것이다.
      숫자가 작은 자원을 잡은 상태에서 큰 숫자를 잡는 것은 허용되지만, 숫자가 큰 자원을 잡은 상태에서 작은 숫자를 잡는 것은 허용하지 않는다.

### 2. 교착 상태 회피
- 프로세스에 자원을 할당할 때 어느 수준 이상의 자원을 나누어주면 교착 상태가 발생하는지 파악하여 그 수준 이하로 자원을 나누어주는 방법이다.
  자원을 많이 할당할수록 교착 상태가 발생할 확률이 커지기 때문에 교착 상태가 발생하지 않는 범위 내에서만 자원을 할당하고, 교착 상태가 발생하는 범위에 있으면 프로세스를 대기시킨다.
  교착 상태 회피에서는 자원의 총수와 현재 할당된 자원의 수를 기준으로 시스템을 안정 상태(Safe State)와 불안정 상태(Unsafe State)로 나누고 시스템이 안정 상태를 유지하도록 자원을 할당한다.

- **은행원 알고리즘**:
  - 교착 상태 회피를 구현하는 방법 중 한 가지는 은행원 알고리즘이다.
    은행이 대출해 주는 방식, 즉 대출 금액이 가능한 범위 내이면, 즉 안정 상태이면 대출이 허용되지만 그렇지 않으면 거부되는 것과 유사하기 때문에 이러한 명칭이 붙었다.

    <img width="549" alt="다운로드 (2)" src="https://github.com/user-attachments/assets/e31597b1-53a8-4980-ac88-fdad854181aa" />

  - **안정 상태**: 가용 자원이 프로세스의 기대 자원보다 크거나 같은 경우.
  - **불안정 상태**: 가용 자원이 프로세스의 기대 자원보다 작은 경우.

- **교착 상태 회피의 문제점**:
  - 첫 번째로, 교착 상태 회피 방법을 사용하려면 프로세스가 자신이 사용할 자원을 미리 선언해야 하는데 이는 쉬운 일이 아니다.
  - 두 번째로, 은행원 알고리즘에서 안정 상태나 불안정 상태를 파악하려면 시스템의 전체 자원 수가 고정적이어야 하는데 실제로는 시스템의 자원 수가 유동적이다는 점이다.
  - 마지막으로, 교착 상태 회피에서는 실제로 교착 상태가 발생하지 않는데도 발생할 것이라고 예상하고 프로세스에 자원을 할당하는 데 제약을 둔다는 점이다.


### 3. 교착 상태 검출
- 교착 상태 발생 여부를 주기적으로 점검.
- **타임아웃**: 타임아웃을 이용하여 일정 시간 동안 작업이 진행되지 않는 프로세스를 교착 상태가 발생한 것으로 간주하여 처리하는 방법이다.
  실제로 유닉스나 윈도우 같은 운영체제에서는 일정 시간 동안 작업이 진행되지 않으면 해당 프로세스를 죽인다. 타임아웃을 이용하는 방법을 '가벼운 교착 상태 검출'이라고도 한다.
- **자원 할당 그래프를 이용한 교착 상태 검출**: 자원 할당 그래프를 보면 시스템 내의 프로세스가 어떤 자원을 사용하고 있는지 혹은 기다리고 있는지 알 수 있다.

![다운로드](https://github.com/user-attachments/assets/260caf1b-ecb5-4f6a-90c7-64f4f0a534dc)

- 자원 할당 그래프를 이용하여 교착 상태를 검출하는 방법은 프로세스의 작업 방식을 제한하지 않으면서 교착 상태를 정확하게 파악할 수 있다는 것이 장점이다.
  하지만, 자원 할당 그래프를 유지, 갱신, 사이클 검사 같은 추가 작업으로 인해 오버헤드가 발생한다는 단점이 있다


### 4. 교착 상태 회복
- 교착 상태를 유발한 프로세스를 강제 종료.
- 모든 프로세스를 종료하거나, 하나씩 순차적으로 종료.

